/*
 * ==========================================================
 * LangGraph BioFlow - Nextflow Configuration
 * Author: Manish Kumar
 * Description: Config for multi-step genomic pipeline using
 *              FastQC → BWA → Samtools → Picard → GATK → SnpEff
 * ==========================================================
 */

params {
    // Input & Output paths
    reads        = "data/fastq/*_{R1,R2}_001.fastq.gz"
    reference    = "data/reference/genome.fa"
    output_dir   = "results"

    // Threads & Memory defaults
    max_cpus     = 8
    max_memory   = '16 GB'
}

// ==========================================================
// Executor Settings
// ==========================================================
process {
    executor = 'local'
    cpus     = { task.cpus ?: 4 }
    memory   = { task.memory ?: '8 GB' }
    time     = '4h'

    errorStrategy = 'retry'
    maxRetries    = 2

    // Default container (for misc. tasks)
    container = 'ubuntu:22.04'

    // Each tool's container image
    withName: 'FASTQC' {
        container = 'quay.io/biocontainers/fastqc:0.12.1--hdfd78af_0'
    }

    withName: 'BWA_ALIGN' {
        container = 'biocontainers/bwa:v0.7.17_cv1'
    }

    withName: 'SAMTOOLS_SORT' {
        container = 'biocontainers/samtools:v1.19.2_cv1'
    }

    withName: 'PICARD_MARKDUP' {
        container = 'biocontainers/picard:v3.1.1--hdfd78af_0'
    }

    withName: 'GATK_HAPLOTYPECALLER' {
        container = 'broadinstitute/gatk:4.5.0.0'
    }

    withName: 'SNPEFF' {
        container = 'biocontainers/snpeff:v5.2-1-deb_cv1'
    }
}

// ==========================================================
// Docker Settings
// ==========================================================
docker {
    enabled = true
    runOptions = '--platform linux/amd64 --shm-size=2g'
}

// ==========================================================
// Work & Reports
// ==========================================================
workDir  = "./work"
timeline.enabled = true
trace.enabled    = true
report.enabled   = true
dag.enabled      = true
report.overwrite = true
timeline.overwrite = true


// ==========================================================
// Profiles
// ==========================================================
profiles {
    standard {
        process.executor = 'local'
    }

    dgx_gpu {
        docker.enabled = true
        docker.runOptions = '--gpus all --ipc=host --platform linux/amd64'
    }
}
